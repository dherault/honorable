import{a as oe,b as F,c as L,d as m,e as d,f as g,g as u,h as $,i as D,j as y,k as I,l as b,m as K,n as B,p as H}from"./chunk-KHJLZRDT.mjs";import{a as C}from"./chunk-ZZWMINIV.mjs";import"./chunk-YAUJ367U.mjs";import{a as te}from"./chunk-U4FGYVCJ.mjs";import"./chunk-M6WCQ5XD.mjs";import{a as v,b as h,d as k,e as T,s as x}from"./chunk-HIOBFJTH.mjs";import{b as ee}from"./chunk-7P7MBUK4.mjs";import"./chunk-JVL5FG27.mjs";import"./chunk-XMWX3DS4.mjs";import{e as c}from"./chunk-7AG3PZXC.mjs";var O=c(v());var w=c(v(),1);var Y=c(oe(),1),{window:n,document:p,location:S}=w.default,P="storybook-channel",re={allowFunction:!0,maxDepth:25},ne=class{constructor(t){if(this.config=t,this.buffer=[],this.handler=null,n&&n.addEventListener("message",this.handleEvent.bind(this),!1),t.page!=="manager"&&t.page!=="preview")throw new Error(`postmsg-channel: "config.page" cannot be "${t.page}"`)}setHandler(t){this.handler=(...e)=>{t.apply(this,e),!this.connected&&this.getLocalFrame().length&&(this.flush(),this.connected=!0)}}send(t,e){let{target:o,allowRegExp:r,allowFunction:s,allowSymbol:i,allowDate:a,allowUndefined:l,allowClass:W,maxDepth:G,space:V,lazyEval:z}=e||{},J=Object.fromEntries(Object.entries({allowRegExp:r,allowFunction:s,allowSymbol:i,allowDate:a,allowUndefined:l,allowClass:W,maxDepth:G,space:V,lazyEval:z}).filter(([f,E])=>typeof E<"u")),Q={...re,...w.default.CHANNEL_OPTIONS||{},...J},N=this.getFrames(o),X=Y.default.parse(S.search,{ignoreQueryPrefix:!0}),Z=g({key:P,event:t,refId:X.refId},Q);return N.length?(this.buffer.length&&this.flush(),N.forEach(f=>{try{f.postMessage(Z,"*")}catch{console.error("sending over postmessage fail")}}),Promise.resolve(null)):new Promise((f,E)=>{this.buffer.push({event:t,resolve:f,reject:E})})}flush(){let{buffer:t}=this;this.buffer=[],t.forEach(e=>{this.send(e.event).then(e.resolve).catch(e.reject)})}getFrames(t){if(this.config.page==="manager"){let e=[...p.querySelectorAll("iframe[data-is-storybook][data-is-loaded]")].filter(o=>{try{return!!o.contentWindow&&o.dataset.isStorybook!==void 0&&o.id===t}catch{return!1}}).map(o=>o.contentWindow);return e.length?e:this.getCurrentFrames()}return n&&n.parent&&n.parent!==n?[n.parent]:[]}getCurrentFrames(){return this.config.page==="manager"?[...p.querySelectorAll('[data-is-storybook="true"]')].map(t=>t.contentWindow):n&&n.parent?[n.parent]:[]}getLocalFrame(){return this.config.page==="manager"?[...p.querySelectorAll("#storybook-preview-iframe")].map(t=>t.contentWindow):n&&n.parent?[n.parent]:[]}handleEvent(t){try{let{data:e}=t,{key:o,event:r,refId:s}=typeof e=="string"&&d(e)?u(e,w.default.CHANNEL_OPTIONS||{}):e;if(o===P){let i=this.config.page==="manager"?'<span style="color: #37D5D3; background: black"> manager </span>':'<span style="color: #1EA7FD; background: black"> preview </span>',a=Object.values(m).includes(r.type)?`<span style="color: #FF4785">${r.type}</span>`:`<span style="color: #FFAE00">${r.type}</span>`;if(s&&(r.refId=s),r.source=this.config.page==="preview"?t.origin:se(t),!r.source){k.error(`${i} received ${a} but was unable to determine the source of the event`);return}let l=`${i} received ${a} (${e.length})`;k.debug(S.origin!==r.source?l:`${l} <span style="color: gray">(on ${S.origin} from ${r.source})</span>`,...r.args),this.handler(r)}}catch(e){h.error(e)}}},se=t=>{let e=[...p.querySelectorAll("iframe[data-is-storybook]")],[o,...r]=e.filter(s=>{try{return s.contentWindow===t.source}catch{}let i=s.getAttribute("src"),a;try{({origin:a}=new URL(i,p.location))}catch{return!1}return a===t.origin});if(o&&r.length===0){let s=o.getAttribute("src"),{protocol:i,host:a,pathname:l}=new URL(s,p.location);return`${i}//${a}${l}`}return r.length>0&&h.error("found multiple candidates for event source"),null};function _({page:t}){let e=new ne({page:t});return new y({transport:e})}var U=c(v());var{WebSocket:ie}=U.default,A=class{constructor({url:e,onError:o}){this.socket=void 0,this.handler=void 0,this.buffer=[],this.isReady=!1,this.connect(e,o)}setHandler(e){this.handler=e}send(e){this.isReady?this.sendNow(e):this.sendLater(e)}sendLater(e){this.buffer.push(e)}sendNow(e){let o=g(e,{maxDepth:15,allowFunction:!0});this.socket.send(o)}flush(){let{buffer:e}=this;this.buffer=[],e.forEach(o=>this.send(o))}connect(e,o){this.socket=new ie(e),this.socket.onopen=()=>{this.isReady=!0,this.flush()},this.socket.onmessage=({data:r})=>{let s=typeof r=="string"&&d(r)?u(r):r;this.handler(s)},this.socket.onerror=r=>{o&&o(r)}}};function j({url:t,async:e=!1,onError:o=r=>h.warn(r)}){let r=new A({url:t,onError:o});return new y({transport:r,async:e})}var ce=c(ee()),pe=c(te());var q={react:ce,"react-dom":pe,"@storybook/components":D,"@storybook/channels":I,"@storybook/core-events":m,"@storybook/router":F,"@storybook/theming":x,"@storybook/api":$,"@storybook/addons":K,"@storybook/client-logger":T};var{FEATURES:he,SERVER_CHANNEL_URL:M}=O.default,R=class extends B{constructor(){super();let o=_({page:"manager"});if(b.setChannel(o),o.emit(L),this.addons=b,this.channel=o,he?.storyStoreV7&&M){let r=j({url:M});this.serverChannel=r,b.setServerChannel(this.serverChannel)}}getElements(o){return this.addons.getElements(o)}getConfig(){return this.addons.getConfig()}handleAPI(o){this.addons.loadAddons(o)}},{document:fe}=O.default,me=fe.getElementById("root");H(me,new R);Object.keys(C).forEach(t=>{O.default[C[t]]=q[t]});
